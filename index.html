<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TONY'S DEVIL HOTDOG</title>
    <link rel="icon" href="https://www.gstatic.com/android/keyboard/emojikitchen/20201001/u1f608/u1f608_u1f32d.png" type="image/png">
    
    <link href="https://seed-design.line.me/static/css/line-seed-kr.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Monoton&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-pink: #ff007f;
            --neon-purple: #bc13fe;
            --neon-blue: #00f3ff;
            --neon-yellow: #fdfd96;
            --bg-deep: #05050a;
            --receipt-paper: #ffffff;
            --bulb-on: #fffb00;
            --bulb-off: #554400;
        }

        * {
            box-sizing: border-box;
            cursor: url('https://raw.githubusercontent.com/googlefonts/noto-emoji/main/svg/emoji_u1f525.svg') 16 16, auto;
        }

        body {
            background: url('https://images.unsplash.com/photo-1611107875582-684c70574042?q=80&w=1470&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            font-family: 'LINE Seed KR', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            overflow: hidden;
        }

        /* ì‚¬ì´ì¦ˆ 80%ë¡œ ì¶•ì†Œ */
        .scale-wrapper {
            transform: scale(0.8);
            transform-origin: center;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .marquee-frame {
            position: relative;
            padding: 25px;
            background: #221100;
            border-radius: 60px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            border: 4px solid #443311;
        }

        .bulb-container {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none; border-radius: 55px;
        }
        .bulb {
            position: absolute; width: 16px; height: 16px;
            background: var(--bulb-off); border-radius: 50%;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.5); transition: 0.1s;
        }
        .bulb.on {
            background: var(--bulb-on);
            box-shadow: 0 0 10px var(--bulb-on), 0 0 20px var(--bulb-on);
        }

        .billboard-frame {
            position: relative; width: 900px;
            background: #000; border-radius: 45px;
            box-shadow: 0 0 20px var(--neon-purple), 0 0 40px var(--neon-pink);
            border: 4px solid #111; z-index: 2;
        }

        .billboard-inner {
            background: rgba(8, 8, 15, 0.95); border-radius: 35px;
            padding: 40px; display: grid; grid-template-columns: 1.1fr 0.9fr;
            gap: 40px; position: relative; border: 2px solid #222;
        }

        .neon-light {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 35px; border: 4px solid var(--neon-purple);
            box-shadow: 0 0 15px var(--neon-purple), 0 0 30px var(--neon-pink), inset 0 0 15px var(--neon-purple), inset 0 0 30px var(--neon-pink);
            animation: ultra-glow 1.5s infinite alternate; pointer-events: none;
        }

        @keyframes ultra-glow {
            from { filter: brightness(1) contrast(1); opacity: 0.8; }
            to { filter: brightness(1.5) contrast(1.2); opacity: 1; box-shadow: 0 0 25px var(--neon-pink), 0 0 50px var(--neon-blue), inset 0 0 20px var(--neon-pink); }
        }

        .flash-effect { animation: flashBang 0.5s ease-out; }
        @keyframes flashBang {
            0% { box-shadow: 0 0 0 0 rgba(255,255,255,0); }
            10% { box-shadow: 0 0 100px 100px rgba(255,255,255,0.8), inset 0 0 100px 100px rgba(255,255,255,0.8); background: #fff; }
            100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); background: rgba(8, 8, 15, 0.95); }
        }

        .header { grid-column: span 2; text-align: center; margin-bottom: 5px; }
        .header h1 {
            font-family: 'Bangers', cursive; font-size: 3.8rem; line-height: 0.9; margin: 0;
            color: var(--neon-yellow); text-shadow: 0 0 15px var(--neon-yellow), 0 0 30px var(--neon-pink), 0 0 50px var(--neon-pink);
        }
        .header .sub-location {
            font-family: 'Monoton', cursive; font-size: 1.5rem; color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue); margin-top: 5px; display: block;
        }

        .receipt {
            background-color: var(--receipt-paper); color: #111;
            padding: 35px 25px 60px 25px; min-height: 500px;
            box-shadow: 15px 15px 0px rgba(0,0,0,0.5); position: relative;
            mask-image: linear-gradient(to bottom, transparent 0, transparent 10px, black 10px, black calc(100% - 10px), transparent calc(100% - 10px)), conic-gradient(from -45deg at bottom, #000 90deg, #0000 0) bottom / 20px 10px repeat-x, conic-gradient(from 135deg at top, #000 90deg, #0000 0) top / 20px 10px repeat-x;
            -webkit-mask-image: linear-gradient(to bottom, transparent 0, transparent 10px, black 10px, black calc(100% - 10px), transparent calc(100% - 10px)), conic-gradient(from -45deg at bottom, #000 90deg, #0000 0) bottom / 20px 10px repeat-x, conic-gradient(from 135deg at top, #000 90deg, #0000 0) top / 20px 10px repeat-x;
        }

        .rune-ticket {
            position: absolute; top: 15px; right: -15px; background: #ffeb3b; color: #d50000;
            padding: 8px 15px; font-family: 'Bangers'; font-size: 1.1rem; transform: rotate(15deg);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3); border: 1px dashed #d50000; cursor: pointer; z-index: 10; transition: 0.2s;
        }
        .rune-ticket:hover { transform: rotate(10deg) scale(1.1); }
        .rune-ticket::before {
            content: ''; position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 8px; height: 20px; background: #888; border-radius: 5px;
        }

        .receipt-head { text-align: center; border-bottom: 2px dashed #444; padding-bottom: 15px; margin-bottom: 20px; }
        .receipt-head h2 { font-family: 'Bangers'; font-size: 2.2rem; margin: 0; color: #e63946; letter-spacing: 1px; }
        .receipt-footer {
            position: absolute; bottom: 25px; left: 0; right: 0;
            text-align: center; font-family: 'Bangers'; font-size: 1.2rem;
            color: rgba(0, 0, 0, 0.1); letter-spacing: 2px; pointer-events: none;
        }

        #todo-input {
            width: 100%; border: none; background: #f0f0f0; padding: 12px;
            font-family: 'LINE Seed KR'; font-weight: bold; outline: none; border-radius: 5px; margin-bottom: 10px;
        }
        .todo-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px dotted #aaa; font-size: 0.95rem; font-weight: 600;
        }
        .todo-text.done { text-decoration: line-through; color: #999; }

        .left-zone { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .hotdog-display {
            width: 100%; height: 280px; background: #05050a; border-radius: 30px;
            border: 2px solid #222; display: flex; justify-content: center; align-items: center; position: relative;
            box-shadow: inset 0 0 20px #000; overflow: hidden;
        }
        #hotdog-img { width: 170px; transition: 0.4s; z-index: 5; }

        #subtitles {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: var(--neon-yellow); font-style: italic; font-weight: bold; font-size: 1rem;
            text-shadow: 0 0 5px rgba(0,0,0,0.8); z-index: 10;
        }

        #timer {
            font-family: 'Monoton', cursive; font-size: 6rem;
            color: #fff; text-shadow: 0 0 20px var(--neon-blue), 0 0 40px var(--neon-blue); margin: 0;
        }

        .btn-group { display: flex; gap:10px; width: 100%; }
        .btn {
            flex: 1; padding: 18px 0; border: none; border-radius: 15px;
            font-family: 'Bangers'; font-size: 1.6rem; cursor: pointer; transition: 0.3s;
        }
        .btn-go { background: var(--neon-pink); color: #fff; box-shadow: 0 0 20px var(--neon-pink); }
        .btn-stop { background: #222; color: #666; }
        .btn-break { background: var(--neon-blue); color: #000; box-shadow: 0 0 15px var(--neon-blue); }
        .btn-break:disabled { background: #333; color: #555; box-shadow: none; cursor: not-allowed; opacity: 0.7; }
        .btn:not(:disabled):hover { transform: translateY(-5px) scale(1.02); }

        .stat-bar {
            grid-column: span 2; margin-top: 20px; background: rgba(255, 255, 255, 0.05);
            padding: 20px 30px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center;
            white-space: nowrap; /* í•œì¤„ ê°•ì œ */
            overflow: hidden;
        }
        .stat-info { flex-grow: 1; font-size: 1.1rem; }
        .stat-info b { color: var(--neon-yellow); font-size: 1.3rem; margin-left: 5px; margin-right: 15px; }
        .copy-btn {
            background: var(--neon-blue); color: #000; padding: 10px 20px; flex-shrink: 0;
            border-radius: 10px; font-weight: 900; border: none; box-shadow: 0 0 15px var(--neon-blue);
        }

        /* 5ì´ˆ íœ´ì‹ ì œì•ˆ íŒì—… */
        .break-popup {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            background: rgba(0,0,0,0.9); border: 4px solid var(--neon-blue);
            padding: 30px; border-radius: 25px; text-align: center; z-index: 100;
            transition: 0.3s; pointer-events: none; opacity: 0;
        }
        .break-popup.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: all; }
        .break-popup h3 { color: var(--neon-blue); font-family: 'Bangers'; font-size: 2.5rem; margin: 0 0 15px 0; }
        .break-timer-bar { width: 100%; height: 5px; background: #333; margin-top: 15px; position: relative; }
        .break-timer-fill { position: absolute; left: 0; top: 0; height: 100%; width: 100%; background: var(--neon-blue); transition: width 5s linear; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: #1a1a2e; border: 4px solid var(--neon-blue);
            padding: 40px; border-radius: 30px; text-align: center; max-width: 500px;
            box-shadow: 0 0 50px var(--neon-blue); position: relative; color: #fff;
        }
        .modal-content h3 { font-family: 'Bangers'; font-size: 2.5rem; color: var(--neon-yellow); margin: 0 0 20px 0; }
        .rune-symbol { font-size: 5rem; color: var(--neon-pink); margin: 20px 0; display: block; text-shadow: 0 0 20px var(--neon-pink); }
        .rune-name { font-size: 1.5rem; font-weight: bold; margin-bottom: 10px; color: var(--neon-blue); }
        .rune-desc { font-size: 0.9rem; color: #ccc; margin-bottom: 20px; line-height: 1.4; }
        .tony-comment { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; font-style: italic; color: var(--neon-yellow); border-left: 4px solid var(--neon-pink); }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 2rem; cursor: pointer; color: #fff; }
        .redraw-btn { margin-top: 20px; background: var(--neon-purple); border: none; padding: 10px 20px; color: white; font-weight: bold; border-radius: 10px; cursor: pointer; }

        /* ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ */
        .wiggle { animation: wiggle 0.8s infinite; }
        
        /* í–‰ë³µ: í•‘í¬ìƒ‰ ê¸€ë¡œìš° */
        .happy { 
            animation: jump 0.4s infinite alternate; 
            filter: drop-shadow(0 0 20px var(--neon-pink)); 
        }
        
        /* íœ´ì‹: í•˜ëŠ˜ìƒ‰ ê¸€ë¡œìš° & ì¢Œìš° í†µí†µ */
        .resting { 
            animation: side-jump 0.8s infinite ease-in-out; 
            filter: drop-shadow(0 0 20px var(--neon-blue)); 
        }

        .sad { filter: grayscale(1) brightness(0.4); transform: rotate(90deg) scale(0.85); }

        @keyframes wiggle { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg) scale(1.1); } }
        @keyframes jump { from { transform: translateY(0); } to { transform: translateY(-30px); } }
        @keyframes side-jump { 
            0%, 100% { transform: translateX(-20px) rotate(-5deg); } 
            50% { transform: translateX(20px) rotate(5deg); } 
        }
    </style>
</head>
<body>

<div class="scale-wrapper">
    <div class="marquee-frame">
        <div class="bulb-container" id="bulb-container"></div>
        
        <div class="billboard-frame" id="main-board">
            <div class="neon-light"></div>
            <div class="billboard-inner">
                
                <header class="header">
                    <h1>TONY'S <br> DEVIL HOTDOG</h1>
                    <span class="sub-location">in California</span>
                </header>

                <div class="left-zone">
                    <div class="hotdog-display" id="stage">
                        <div id="subtitles">- ì—¬ê¸°, ë‚˜ ì¢€ ë´ì¤˜!</div>
                        <!-- íœ´ì‹ ì œì•ˆ íŒì—… -->
                        <div class="break-popup" id="break-popup">
                            <h3>WANNA REST?</h3>
                            <p style="margin:0; color:#fff;">íœ´ì‹ì‹œê°„ 5ë¶„ ì“¸ë˜?</p>
                            <button onclick="confirmBreak()" style="margin-top:15px; background:var(--neon-blue); border:none; padding:10px 20px; font-weight:bold; cursor:pointer;">YES, PLEASE</button>
                            <div class="break-timer-bar"><div class="break-timer-fill" id="break-timer-fill"></div></div>
                        </div>
                        <img src="https://www.gstatic.com/android/keyboard/emojikitchen/20201001/u1f608/u1f608_u1f32d.png" id="hotdog-img" class="wiggle">
                    </div>
                    <div id="timer">25:00</div>
                    <div class="btn-group">
                        <button class="btn btn-go" id="start-btn">ORDER START</button>
                        <button class="btn btn-break" id="break-btn" disabled>BREAK (0)</button>
                        <button class="btn btn-stop" id="stop-btn">GET COLD</button>
                    </div>
                </div>

                <div class="receipt">
                    <div class="rune-ticket" onclick="openRuneModal()">
                        FREE<br>SERVICE
                    </div>

                    <div class="receipt-head">
                        <h2><img src="https://raw.githubusercontent.com/googlefonts/noto-emoji/main/svg/emoji_u1f608.svg" width="26"> DEVIL'S ORDER</h2>
                        <p id="receipt-date" style="margin: 5px 0; font-size: 0.8rem; font-weight: bold; color: #666;">DATE: 2026.01.09</p>
                        <p style="margin: 0; letter-spacing: -1px; color: #999;">************************************</p>
                    </div>
                    <input type="text" id="todo-input" placeholder="ì—¬ê¸°ì— ì˜¤ëŠ˜ì˜ ì•…ë§ˆì  ê³„íšì„ ì ì–´ë´...">
                    <ul class="todo-list" id="todo-list" style="list-style:none; padding:0; margin:0;"></ul>
                    <div class="receipt-footer">TONY'S DEVIL HOTDOG</div>
                </div>

                <div class="stat-bar">
                    <div class="stat-info">
                        ì´ ì£¼ë¬¸ëŸ‰: <b id="stat-count">0</b> ì„¸ì…˜ | ëˆ„ì  ê´€ì‹¬: <b id="stat-time">0</b> ë¶„ | ì‚¬ìš©í•œ íœ´ì‹: <b id="stat-break">0</b> ë¶„
                    </div>
                    <button class="copy-btn" onclick="copyReceipt()">ì˜ìˆ˜ì¦</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ë£¬ìŠ¤í†¤ ëª¨ë‹¬ (ë™ì¼) -->
<div class="modal-overlay" id="rune-modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeRuneModal()">&times;</span>
        <h3>TODAY'S RUNE</h3>
        <span class="rune-symbol" id="rune-symbol">?</span>
        <div class="rune-name" id="rune-name">UNKNOWN</div>
        <div class="rune-desc" id="rune-desc">...</div>
        <div class="tony-comment" id="tony-comment">"..."</div>
        <button class="redraw-btn" onclick="drawRune()">ğŸ”„ ë‹¤ì‹œ ë½‘ê¸°</button>
    </div>
</div>

<script>
    /* --- Basic Variables --- */
    let timer;
    let autoContinueTimer;
    let timeLeft = 25 * 60;
    let isRunning = false;
    let mode = 'focus'; // 'focus' or 'break'
    
    // ì €ì¥ëœ ìŠ¤íƒ¯ ë¶ˆëŸ¬ì˜¤ê¸°
    let count = parseInt(localStorage.getItem('tony_ca_count') || 0);
    let totalMins = parseInt(localStorage.getItem('tony_ca_mins') || 0);
    let totalBreakMins = parseInt(localStorage.getItem('tony_total_break') || 0);
    let breakBalance = parseInt(localStorage.getItem('tony_break_balance') || 0); // ì ë¦½ëœ íœ´ì‹ ì‹œê°„ (ë¶„)

    const hotdogImg = document.getElementById('hotdog-img');
    const subtitles = document.getElementById('subtitles');
    const timerDisplay = document.getElementById('timer');
    const todoInput = document.getElementById('todo-input');
    const todoList = document.getElementById('todo-list');
    const mainBoard = document.querySelector('.billboard-inner');
    const breakBtn = document.getElementById('break-btn');
    const breakPopup = document.getElementById('break-popup');
    const breakTimerFill = document.getElementById('break-timer-fill');

    const IMG_DEVIL = "https://www.gstatic.com/android/keyboard/emojikitchen/20201001/u1f608/u1f608_u1f32d.png";
    const IMG_SAD = "https://raw.githubusercontent.com/googlefonts/noto-emoji/main/svg/emoji_u1f32d.svg";

    const idleQuotes = ["- ì—¬ê¸°, ë‚˜ ì¢€ ë´ì¤˜!", "- ì €ê¸°ìš”? ë˜‘ë˜‘? ê³„ì„¸ìš”?", "- ë‚˜ ì§„ì§œ ì•ˆ ë³¼ ê±°ì•¼?","- ìº˜ë¦¬í¬ë‹ˆì•„ í–‡ì‚´ë³´ë‹¤ ë„¤ ê´€ì‹¬ì´ í•„ìš”í•´.", "- ëª¨ë‹ˆí„° ëš«ê³  ë‚˜ê°„ë‹¤? ì§„ì§œ ë‚˜ê°„ë‹¤?", "- (ì½•ì½•) ì•¼, ê´€ì‹¬ ì¢€ ì¤˜!", "- ì‹ì–´ë²„ë¦°ë‹¤?", "- ë‚˜ ì§€ê¸ˆ ê¸°ë‹¤ë¦¬ê³  ìˆë‹¤ê³ !"];
    const happyQuotes = ["- ì™€! ì§€ê¸ˆ ë„¤ ì§‘ì¤‘ë ¥ ì—„ì²­ë‚œë°?", "- ê·¸ë ‡ì§€! ë‚˜ë§Œ ë°”ë¼ë³´ë¼êµ¬!", "- ë„¤ê°€ ì§‘ì¤‘í•´ ì£¼ë‹ˆê¹Œ ê¸°ë¶„ ìµœê³ ì•¼!", "- í•«ë„ê·¸ë³´ë‹¤ ëœ¨ê±°ìš´ ë„ˆì˜ ì—´ì •!", "- ê·¸ë˜, ê·¸ë ‡ê²Œ í•˜ëŠ” ê±°ì•¼!"];
    const sadQuotes = ["- ë‚œ ê·¸ëƒ¥ ì‹ì€ ë¹µì´ì•¼..", "- ì‹¤ë§ì´ì•¼.", "- ìº˜ë¦¬í¬ë‹ˆì•„ ë“œë¦¼ì€ ëë‚¬ì–´...", "- ì°¨ê°‘ê²Œ ì‹ì–´ê°€ëŠ” ì¤‘...", "- í¥, ì‚ì¡Œì–´."];
    const breakQuotes = ["- ì‰´ ë•ŒëŠ” í™”ëˆí•˜ê²Œ ì‰¬ì–´ì•¼ì§€!", "- ë‚˜ë„ ë°ë ¤ê°€! ì£¼ë¨¸ë‹ˆì— ë“¤ì–´ê°€ì•¼ì§€!", "- ì¶©ì „ ì™„ë£Œë˜ë©´ ì œì¼ ë¨¼ì € ë‚˜ ë³´ëŸ¬ ì™€ì•¼ í•´!" , "- ê·¸ë˜, ë¨¸ë¦¬ ì¢€ ì‹íˆê³  ì™€!", "- ì¹ ë§ íƒ€ì„~"];

    /* --- Stats & UI Update --- */
    function updateDate() {
        const now = new Date();
        document.getElementById('receipt-date').textContent = `DATE: ${now.getFullYear()}.${(now.getMonth()+1).toString().padStart(2,'0')}.${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
    }

    function updateStats() {
        document.getElementById('stat-count').textContent = count;
        document.getElementById('stat-time').textContent = totalMins;
        document.getElementById('stat-break').textContent = totalBreakMins;
        
        breakBtn.textContent = `BREAK (${breakBalance})`;
        if(breakBalance > 0 && !isRunning) {
            breakBtn.disabled = false;
        } else {
            breakBtn.disabled = true;
        }

        localStorage.setItem('tony_ca_count', count);
        localStorage.setItem('tony_ca_mins', totalMins);
        localStorage.setItem('tony_total_break', totalBreakMins);
        localStorage.setItem('tony_break_balance', breakBalance);
    }

    function updateDisplay() {
        const m = Math.floor(timeLeft / 60);
        const s = timeLeft % 60;
        timerDisplay.textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    /* --- Timer Logic --- */

    function startTimer() {
        if (isRunning) return;
        
        // ë§Œì•½ íœ´ì‹ ëª¨ë“œì—ì„œ ì‹œì‘ì„ ëˆ„ë¥´ë©´ -> ê°•ì œ ì¢…ë£Œí•˜ê³  ì§‘ì¤‘ ëª¨ë“œë¡œ ì „í™˜
        if (mode === 'break') {
            stopTimer(); // íœ´ì‹ ì¤‘ë‹¨
        }

        mode = 'focus';
        isRunning = true;
        timeLeft = 25 * 60; // 25ë¶„ ë¦¬ì…‹
        updateDate();
        
        // UI ë³€ê²½
        hotdogImg.src = IMG_DEVIL;
        hotdogImg.className = 'happy'; // í•‘í¬ ê¸€ë¡œìš° + ì í”„
        subtitles.textContent = happyQuotes[Math.floor(Math.random() * happyQuotes.length)];
        breakBtn.disabled = true;

        timer = setInterval(() => {
            timeLeft--;
            updateDisplay();
            if (timeLeft < 0) completeSession();
        }, 1000);
    }

    function startBreak() {
        if (isRunning || breakBalance <= 0) return;
        
        mode = 'break';
        isRunning = true;
        timeLeft = breakBalance * 60; // ì ë¦½ëœ ì‹œê°„ë§Œí¼ íœ´ì‹
        
        // UI ë³€ê²½
        hotdogImg.src = IMG_DEVIL;
        hotdogImg.className = 'resting'; // ë¸”ë£¨ ê¸€ë¡œìš° + ì¢Œìš° ì í”„
        subtitles.textContent = breakQuotes[Math.floor(Math.random() * breakQuotes.length)];
        breakBtn.disabled = true;

        timer = setInterval(() => {
            timeLeft--;
            updateDisplay();

            // íœ´ì‹ ì‹œê°„ì€ ê±°ê¾¸ë¡œ ì°¨ê°ë˜ëŠ” ê²Œ ì•„ë‹ˆë¼, 1ë¶„ ì§€ë‚  ë•Œë§ˆë‹¤ ì”ê³ ì—ì„œ ê¹ëŠ”ê²Œ ë…¼ë¦¬ì ì´ë‚˜
            // ì—¬ê¸°ì„œëŠ” ë‚¨ì€ ì‹œê°„ì„ ë³´ì—¬ì£¼ê³ , ì™„ë£Œëœ ë§Œí¼ ì”ê³  ì°¨ê°í•˜ëŠ” ì‹ìœ¼ë¡œ êµ¬í˜„
            // ê°„ë‹¨í•˜ê²Œ: 1ë¶„ ì§€ë‚  ë•Œë§ˆë‹¤ totalBreakMins++, breakBalance-- ì²˜ë¦¬
            if (timeLeft % 60 === 59) { // 1ë¶„ì´ ì§€ë‚  ë•Œ ë§ˆë‹¤ (ëŒ€ëµ)
                 // ì‹¤ì‹œê°„ ì°¨ê° ë¡œì§ì€ ë³µì¡í•˜ë‹ˆ, ì¢…ë£Œ ì‹œ í•œêº¼ë²ˆì— ì •ì‚°í•˜ê±°ë‚˜ ë¶„ë‹¨ìœ„ ì²´í¬
            }

            if (timeLeft < 0) {
                stopTimer(); // íœ´ì‹ ë -> ëŒ€ê¸° ìƒíƒœ
                subtitles.textContent = "- íœ´ì‹ ë! ì´ì œ ì¼í•´ì•¼ì§€?";
            }
        }, 1000);
    }

    function completeSession() {
        clearInterval(timer); // ì¼ë‹¨ íƒ€ì´ë¨¸ ë©ˆì¶¤
        
        count++;
        totalMins += 25;
        breakBalance += 5; // íœ´ì‹ 5ë¶„ ì ë¦½
        updateStats();

        // í”Œë˜ì‹œ íš¨ê³¼
        mainBoard.classList.add('flash-effect');
        setTimeout(() => mainBoard.classList.remove('flash-effect'), 500);

        // 5ì´ˆ íœ´ì‹ ì œì•ˆ
        hotdogImg.className = 'wiggle';
        subtitles.textContent = "- 25ë¶„ ì»·! ì ê¹ ì‰´ë˜? 5ì´ˆ ì¤€ë‹¤.";
        
        breakPopup.classList.add('active');
        breakTimerFill.style.width = '100%'; // ë°” ê½‰ ì±„ì›€
        
        // CSS transitionìœ¼ë¡œ ì¤„ì–´ë“¤ê²Œ í•˜ê¸° ìœ„í•´ ì ì‹œ í›„ 0ìœ¼ë¡œ
        setTimeout(() => { breakTimerFill.style.width = '0%'; }, 50);

        autoContinueTimer = setTimeout(() => {
            // 5ì´ˆ ë¬´ì‹œ -> ìë™ ë‹¤ìŒ ì„¸ì…˜
            breakPopup.classList.remove('active');
            subtitles.textContent = "- ë…í•˜ë‹¤ ë…í•´... (ëŒ€ë‹¨í•˜ë„¤)";
            
            // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ë°”ë¡œ ì‹œì‘
            setTimeout(() => {
                startTimerLogicOnly(); // UI ë¦¬ì…‹ ì—†ì´ íƒ€ì´ë¨¸ë§Œ ì¬ê°€ë™
            }, 1000);
        }, 5000);
    }

    function confirmBreak() {
        clearTimeout(autoContinueTimer);
        breakPopup.classList.remove('active');
        subtitles.textContent = "- ì˜¤ì¼€ì´, ì‰¬ì!";
        isRunning = false; // íƒ€ì´ë¨¸ ìƒíƒœ ì´ˆê¸°í™”
        startBreak(); // íœ´ì‹ ì‹œì‘
    }

    function startTimerLogicOnly() {
        // ì´ë¯¸ íŒì—… ë‹«í˜, ë°”ë¡œ ë‹¤ìŒ ì„¸ì…˜
        mode = 'focus';
        isRunning = true;
        timeLeft = 25 * 60;
        hotdogImg.className = 'happy';
        updateDisplay();
        breakBtn.disabled = true;
        
        timer = setInterval(() => {
            timeLeft--;
            updateDisplay();
            if (timeLeft < 0) completeSession();
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timer);
        clearTimeout(autoContinueTimer);
        breakPopup.classList.remove('active');
        
        if (mode === 'break') {
            // íœ´ì‹í•˜ë‹¤ ë©ˆì·„ì„ ë•Œ: ì‰° ë§Œí¼ ê³„ì‚° (ì´ˆê¸° ì‹œê°„ - ë‚¨ì€ ì‹œê°„)
            let spentSec = (breakBalance * 60) - (timeLeft + 1); // +1 ë³´ì •
            let spentMin = Math.floor(spentSec / 60);
            if (spentMin > 0) {
                totalBreakMins += spentMin;
                breakBalance -= spentMin;
                if(breakBalance < 0) breakBalance = 0;
            }
            updateStats();
        }

        isRunning = false;
        hotdogImg.src = IMG_SAD;
        hotdogImg.className = 'sad';
        subtitles.textContent = sadQuotes[Math.floor(Math.random() * sadQuotes.length)];
        updateStats();
    }

    /* --- Marquee Lights --- */
    const bulbContainer = document.getElementById('bulb-container');
    function createBulbs() {
        const w = 940; const h = 640; const gap = 40;
        const positions = [];
        for(let i=0; i<w; i+=gap) positions.push({x: i + 20, y: 10});
        for(let i=0; i<h; i+=gap) positions.push({x: w - 10, y: i + 20});
        for(let i=w; i>0; i-=gap) positions.push({x: i - 20, y: h - 10});
        for(let i=h; i>0; i-=gap) positions.push({x: 10, y: i - 20});

        positions.forEach((pos, idx) => {
            const bulb = document.createElement('div');
            bulb.className = 'bulb';
            bulb.style.left = pos.x + 'px'; bulb.style.top = pos.y + 'px';
            bulbContainer.appendChild(bulb);
            setInterval(() => {
                const isEven = idx % 2 === 0;
                const time = Date.now();
                if (Math.floor(time / 500) % 2 === (isEven ? 0 : 1)) bulb.classList.add('on');
                else bulb.classList.remove('on');
            }, 500);
        });
    }
    createBulbs();

    /* --- Rune Data & Logic --- */
    const runes = [
        { s: 'á›—', n: 'Mannaz', k: 'ìì•„, ì¸ë¥˜', t: 'ë„¤ê°€ í˜¼ìì¸ ê²ƒ ê°™ì§€? ì£¼ìœ„ë¥¼ ë´. ë„ ë„ìš¸ ì‚¬ëŒì´ ë„ë ¤ìˆì–´.' },
        { s: 'áš·', n: 'Gebo', k: 'ì„ ë¬¼, íŒŒíŠ¸ë„ˆì‹­', t: 'ë„ˆí•œí…Œ ì—„ì²­ë‚œ ì¬ëŠ¥ì´ ìˆë„¤. ê·¸ê±´ ë°”ë¡œ ë‚  ì•Œì•„ë³´ëŠ” ì•ˆëª©ì´ì§€!' },
        { s: 'áš¨', n: 'Ansuz', k: 'ì§€í˜œ, ë©”ì‹œì§€', t: 'ê·€ë¥¼ ì—´ì–´ ë´. ì¤‘ìš”í•œ íŒíŠ¸ê°€ ë“¤ë¦´ ê±°ì•¼.' },
        { s: 'á›Ÿ', n: 'Othila', k: 'ìœ ì‚°, ê³ í–¥', t: 'ê°€ì§„ ê±¸ ì†Œì¤‘íˆ í•´. ë„¤ê°€ ìŒ“ì•„ì˜¨ ë…¸ë ¥ë“¤ì´ ê³§ í° ìì‚°ì´ ë  ê±°ì•¼.' },
        { s: 'áš¢', n: 'Uruz', k: 'í˜, ìš©ê¸°', t: 'ì§€ê¸ˆ ë„¤ ì—ë„ˆì§€ ë¯¸ì³¤ë‹¤! ê·¸ëŒ€ë¡œ ë°€ê³  ë‚˜ê°€.' },
        { s: 'á›ˆ', n: 'Perth', k: 'ìš´ëª…, ë¹„ë°€', t: 'ì¸ìƒì€ ë„ë°•ì´ì•¼! ì´ë²ˆì—” ë„¤ê°€ ì´ê¸¸ í™•ë¥ ì´ ì•„ì£¼ ë†’ì•„.' },
        { s: 'áš¾', n: 'Nauthiz', k: 'ì¸ë‚´, í•„ìš”', t: 'í˜ë“¤ì–´? ê·¸ê²Œ ë‹¤ ë¼ˆê°€ ë˜ê³  ì‚´ì´ ë˜ëŠ” ê±°ì•¼. ì¡°ê¸ˆë§Œ ë” ë²„í…¨.' },
        { s: 'á›', n: 'Inguz', k: 'ì„±ì·¨, ê²°ì‹¤', t: 'ì”¨ì•—ì€ ì´ë¯¸ ì‹¬ì–´ì¡Œì–´. ëŒ€ë°• ë‚  ì§•ì¡°ì•¼!' },
        { s: 'á›‡', n: 'Eihwaz', k: 'ë°©ì–´, ì¸ë‚´', t: 'ë¶ˆì•ˆí•´í•˜ì§€ ë§ˆ. ë„Œ íŠ¼íŠ¼í•œ ì£¼ëª©ë‚˜ë¬´ì²˜ëŸ¼ ë„ë–¡ì—†ë‹¤ê³ .' },
        { s: 'á›‰', n: 'Algiz', k: 'ë³´í˜¸, ê¸°íšŒ', t: 'ìš°ì£¼ê°€ ë„ ë³´í˜¸í•˜ê³  ìˆìœ¼ë‹ˆ ê²ë¨¹ì§€ ë§ê³  ì§ˆëŸ¬.' },
        { s: 'áš ', n: 'Fehu', k: 'í’ìš”, ì¬ë¬¼', t: 'ëˆ ëƒ„ìƒˆê°€ ë‚˜ëŠ”ë°? ê³§ ì§€ê°‘ì´ ë‘ë‘‘í•´ì§€ê² ì–´.' },
        { s: 'áš¹', n: 'Wunjo', k: 'ê¸°ì¨, ì„±ê³µ', t: 'ì•¼í˜¸! ëª¨ë“  ê²Œ ìˆ ìˆ  í’€ë¦´ ê±°ì•¼. ê·¸ëƒ¥ ì¦ê²¨!' },
        { s: 'á›ƒ', n: 'Jera', k: 'ìˆ˜í™•, ë³´ìƒ', t: 'ë¿Œë¦° ëŒ€ë¡œ ê±°ë‘”ë‹¤. ë„¤ê°€ ì—´ì‹¬íˆ í•œ ë§Œí¼ ê²°ê³¼ê°€ ì˜¬ ê±°ì•¼.' },
        { s: 'áš²', n: 'Kano', k: 'ì—´ì •, ì§€ì‹', t: 'ë„¤ ë¨¸ë¦¬ ìœ„ì— ì „êµ¬ ì¼œì¡Œë‹¤! ì•„ì´ë””ì–´ê°€ ë²ˆëœ©ì¼ ë•Œì•¼.' },
        { s: 'á›', n: 'Teiwaz', k: 'ìŠ¹ë¦¬, ì •ì˜', t: 'ì‹¸ì›Œ ì´ê²¨! ë„Œ ì „ì‚¬ì•¼. ëª©í‘œë¥¼ í–¥í•´ ì§ì§„í•´.' },
        { s: 'á›’', n: 'Berkana', k: 'ì„±ì¥, ì¹˜ìœ ', t: 'ìƒˆë¡œìš´ ê²Œ ìë¼ë‚˜ê³  ìˆì–´. íë§ì´ í•„ìš”í•˜ë©´ ì ê¹ ì‰¬ì–´.' },
        { s: 'á›–', n: 'Ehwaz', k: 'ì´ë™, ë³€í™”', t: 'ì–´ë””ë¡ ê°€ ë– ë‚˜ê±°ë‚˜ ë°”ë€” íƒ€ì´ë°ì´ì•¼.' },
        { s: 'á›š', n: 'Laguz', k: 'ì§ê´€, íë¦„', t: 'ë¨¸ë¦¬ ì“°ì§€ ë§ê³  ëŠë‚Œ ê°€ëŠ” ëŒ€ë¡œ í•´. ë„¤ ì´‰ì´ ë§ì•„.' },
        { s: 'ášº', n: 'Hagalaz', k: 'í˜¼ëˆ, ë³€í™”', t: 'ì™€ì¥ì°½! ì¢€ ê¹¨ì§€ë©´ ì–´ë•Œ? ì›ë˜ ë¶€ì„œì ¸ì•¼ ë” ë©‹ì§„ ê±¸ ìƒˆë¡œ ì§“ëŠ” ë²•ì´ì•¼.' },
        { s: 'áš±', n: 'Raido', k: 'ì—¬í–‰, ë°œì „', t: 'ì¸ìƒì€ ì—¬í–‰ì´ì§€. ë©ˆì¶”ì§€ ë§ê³  ê³„ì† ë‹¬ë ¤.' },
        { s: 'áš¦', n: 'Thurisaz', k: 'ê²½ê³ , ì‹ ì¤‘í•¨', t: 'ì ê¹ ìŠ¤í†±! í•œë²ˆë§Œ ë” ìƒê°í•˜ê³  ì›€ì§ì—¬.' },
        { s: 'á›', n: 'Dagaz', k: 'ëŒíŒŒêµ¬, ë¹›', t: 'ì–´ë‘ìš´ í„°ë„ ëì´ì•¼. ì´ì œ ë¹› ë³¼ ì¼ë§Œ ë‚¨ì•˜ì–´.' },
        { s: 'á›', n: 'Isa', k: 'ì •ì§€, íœ´ì‹', t: 'ì§€ê¸ˆì€ ì–¼ìŒ! ì–µì§€ë¡œ ì›€ì§ì´ì§€ ë§ê³  ì ê¹ ë©ˆì¶°ì„œ ìˆ¨ ì¢€ ëŒë ¤.' },
        { s: 'á›‹', n: 'Sowelu', k: 'ì„±ê³µ, íƒœì–‘', t: 'ë„Œ íƒœì–‘ì´ì•¼. ì¡´ì¬ë§Œìœ¼ë¡œë„ ë¹›ë‚˜.' },
        { s: '?', n: 'Blank', k: 'ë¬´í•œí•œ ê°€ëŠ¥ì„±', t: 'ë°±ì§€ìˆ˜í‘œì•¼. ë„¤ ë¯¸ë˜ëŠ” ë„¤ê°€ ì“°ëŠ” ëŒ€ë¡œ ë  ê±°ì•¼.' }
    ];
    function openRuneModal() { document.getElementById('rune-modal').style.display = 'flex'; drawRune(); }
    function closeRuneModal() { document.getElementById('rune-modal').style.display = 'none'; }
    function drawRune() {
        const r = runes[Math.floor(Math.random() * runes.length)];
        document.getElementById('rune-symbol').textContent = r.s || 'â¬œ';
        document.getElementById('rune-name').textContent = r.n;
        document.getElementById('rune-desc').textContent = `Keyword: ${r.k}`;
        document.getElementById('tony-comment').textContent = `- Tony: "${r.t}"`;
    }

    /* --- Todo & Util --- */
    function addTodo() {
        const val = todoInput.value.trim();
        if (!val) return;
        const li = document.createElement('li');
        li.className = 'todo-item';
        li.innerHTML = `<span class="todo-text" onclick="this.classList.toggle('done')">${val}</span><button style="border:none;background:none;color:red;font-weight:bold;cursor:pointer;" onclick="this.parentElement.remove()">X</button>`;
        todoList.appendChild(li); todoInput.value = "";
    }
    function copyReceipt() {
        let items = "";
        document.querySelectorAll('.todo-item').forEach(item => {
            const text = item.querySelector('.todo-text').textContent;
            const isDone = item.querySelector('.todo-text').classList.contains('done');
            items += `${isDone ? 'âœ…' : 'â'} ${text}\n`;
        });
        const txt = `[TONY'S DEVIL HOTDOG]\nDATE: ${document.getElementById('receipt-date').textContent.replace('DATE: ','')}\n----------------\n${items || "No Orders\n"}----------------\nOrders: ${count}\nFocus: ${totalMins}m\nRest: ${totalBreakMins}m\n----------------`;
        navigator.clipboard.writeText(txt).then(() => alert("THANK YOU!ğŸ˜ˆ"));
    }

    todoInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') addTodo(); });
    document.getElementById('start-btn').addEventListener('click', startTimer);
    document.getElementById('stop-btn').addEventListener('click', stopTimer);
    document.getElementById('break-btn').addEventListener('click', startBreak);
    document.getElementById('stage').addEventListener('click', () => { if(!isRunning && mode === 'focus') startTimer(); });

    updateStats(); updateDisplay(); updateDate();
</script>
</body>
</html>